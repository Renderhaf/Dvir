<html>
<title>Drag And Drop</title>
<body align="center">
  <canvas style="border: 1px solid black" id="myCan" width="1000" height="750"></canvas><br/>
  Gravity: <input type="checkbox" id="gravity" onchange="gravchange(this)" checked = "true" ><br/>
  <script>
    var c = document.getElementById("myCan");
    var ctx = c.getContext("2d");
    var grav = 1;
    var boxs = 100;
    var box = [c.width/2 - boxs/2,0,0,0];
    var offset = [0,0];
    var isgrav = true;

    function getMousePos(canvas, evt) {
      var rect = canvas.getBoundingClientRect();
      return {
        x: evt.clientX - rect.left,
        y: evt.clientY - rect.top
      };
    }
    c.onmousedown = function(e){
      m = getMousePos(c,e);
      if (m["x"] > box[0] && m["x"] < box[0]+boxs && m["y"] > box[1] && m["y"] < box[1]+boxs){
        offset = [m["x"]-box[0],m["y"]-box[1]]
        grav = 0;
        box[2] = 0;
        c.onmousemove = function(e){
          m = getMousePos(c,e);
          box[0] = m["x"]-offset[0];
          box[1] = m["y"]-offset[1];
        }
      }
    }
    c.onmouseup = function(e){
      c.onmousemove = null;
      grav = 1;
    }

    function gravchange(cb){
      isgrav = cb.checked;
    }

    function draw(){
      ctx.clearRect(0,0,c.width,c.height);

      //gravity
      if (isgrav){
        box[2] += grav;
        if (box[1] + boxs + box[2] >= c.height){
          box[1] = c.height - boxs;
          box[2] = -box[2] * 0.3
        } else {
          box[1] += box[2];
        }
      }

      ctx.fillRect(box[0],box[1],boxs,boxs);
      window.requestAnimationFrame(draw);
    }
    window.requestAnimationFrame(draw);
  </script>
</body>
</html>
